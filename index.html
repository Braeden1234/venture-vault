<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Venture Vault - BFC Store</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #0b0b0b;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      position: relative;
      background-image: radial-gradient(rgba(20,20,20,0.4) 1px, transparent 1px);
      background-size: 4px 4px;
    }

    .canvas-container {
      position: relative;
      height: 25vh;
      background: linear-gradient(180deg, #000000 0%, #0a0a0a 100%);
      border-bottom: 2px solid rgba(213, 159, 15, 0.4);
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.8);
    }

    #canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: block;
      opacity: 0.7;
    }

    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 50;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      pointer-events: none;
      text-align: center;
    }

    .venture-vault {
      font-size: 6.5vw;
      font-weight: 900;
      color: #D59F0F;
      text-transform: uppercase;
      letter-spacing: 0.8vw;
      text-shadow: 
        0 0 40px rgba(213,159,15,0.6),
        0 0 80px rgba(213,159,15,0.3),
        3px 3px 0 #000;
      line-height: 1;
      filter: drop-shadow(0 4px 12px rgba(0,0,0,0.8));
    }

    .subtitle {
      color: #fff;
      font-size: 1.4vw;
      font-weight: 600;
      letter-spacing: 0.6vw;
      text-transform: uppercase;
      margin-top: 0.8vh;
      background: rgba(0,0,0,0.5);
      padding: 0.5vh 1.5vw;
      border-radius: 50px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(213,159,15,0.5);
      box-shadow: 
        0 4px 16px rgba(0,0,0,0.6),
        inset 0 1px 0 rgba(255,255,255,0.1);
    }

    .carousel-wrapper {
      position: relative;
      width: 100%;
      height: 63vh;
      perspective: 1500px;
      overflow: hidden;
      padding: 1.5vh 0;
      background: transparent;
    }

    .carousel-wrapper::before,
    .carousel-wrapper::after {
      content: '';
      position: absolute;
      top: 0;
      width: 15vw;
      height: 100%;
      z-index: 100;
      pointer-events: none;
    }
    
    .carousel-wrapper::before {
      left: 0;
      background: linear-gradient(90deg, #0b0b0b 5%, transparent 100%);
    }
    
    .carousel-wrapper::after {
      right: 0;
      background: linear-gradient(90deg, transparent 0%, #0b0b0b 95%);
    }

    .carousel-container {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
    }

    .carousel-track {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .carousel-item {
      position: absolute;
      width: min(23vw, calc(63vh * 0.54));
      height: min(28.75vw, calc(63vh * 0.675));
      background: linear-gradient(145deg, #111 0%, #0a0a0a 100%);
      border: 1px solid rgba(213, 159, 15, 0.3);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      will-change: transform, opacity, filter;
      box-shadow: 
        0 20px 40px rgba(0,0,0,0.8),
        0 0 0 1px rgba(255,255,255,0.05);
      transform-style: preserve-3d;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      transition: all 1.5s cubic-bezier(0.45, 0.05, 0.55, 0.95);
      backface-visibility: hidden;
    }

    .carousel-item.active {
      transform: translate(-50%, -50%) translateZ(120px) scale(1.16);
      box-shadow: 
        0 30px 80px rgba(0, 0, 0, 0.9),
        0 0 60px rgba(213, 159, 15, 0.5),
        0 0 100px rgba(213, 159, 15, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(213, 159, 15, 0.7);
      z-index: 50;
      filter: brightness(1.1) contrast(1.05);
    }

    .carousel-item.active .carousel-item-content {
      opacity: 1;
    }

    .carousel-item.left {
      transform: translate(-50%, -50%) translateX(calc(min(23vw, calc(63vh * 0.54)) * -1.4)) translateZ(60px) rotateY(18deg) scale(0.92);
      opacity: 1;
      filter: brightness(0.85);
    }

    .carousel-item.right {
      transform: translate(-50%, -50%) translateX(calc(min(23vw, calc(63vh * 0.54)) * 1.4)) translateZ(60px) rotateY(-18deg) scale(0.92);
      opacity: 1;
      filter: brightness(0.85);
    }

    .carousel-item.far-left {
      transform: translate(-50%, -50%) translateX(calc(min(23vw, calc(63vh * 0.54)) * -2.35)) translateZ(0px) rotateY(30deg) scale(0.79);
      opacity: 1;
      filter: brightness(0.7);
    }

    .carousel-item.far-right {
      transform: translate(-50%, -50%) translateX(calc(min(23vw, calc(63vh * 0.54)) * 2.35)) translateZ(0px) rotateY(-30deg) scale(0.79);
      opacity: 1;
      filter: brightness(0.7);
    }

    .carousel-item.edge-left {
      transform: translate(-50%, -50%) translateX(calc(min(23vw, calc(63vh * 0.54)) * -3.8)) translateZ(-50px) rotateY(40deg) scale(0.68);
      opacity: 0;
      filter: brightness(0.5);
    }

    .carousel-item.edge-right {
      transform: translate(-50%, -50%) translateX(calc(min(23vw, calc(63vh * 0.54)) * 3.8)) translateZ(-50px) rotateY(-40deg) scale(0.68);
      opacity: 0;
      filter: brightness(0.5);
    }

    .carousel-item.hidden {
      transform: translate(-50%, -50%) translateX(calc(min(23vw, calc(63vh * 0.54)) * -5)) translateZ(-200px) scale(0.3);
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      clip-path: inset(0 100% 0 0);
    }

    .carousel-item.hidden.right-hidden {
      transform: translate(-50%, -50%) translateX(calc(min(23vw, calc(63vh * 0.54)) * 5)) translateZ(-200px) scale(0.3);
      clip-path: inset(0 0 0 100%);
    }

    .product-image-container {
      position: relative;
      background: #000;
      width: 100%;
      height: 72%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border-bottom: 1px solid rgba(213,159,15,0.25);
    }

    .carousel-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(0.95) contrast(1.08) saturate(1.05);
      transition: transform 0.8s cubic-bezier(0.23, 1, 0.32, 1), filter 0.8s ease;
      image-rendering: -webkit-optimize-contrast;
    }

    .carousel-item.active img {
      filter: brightness(1.05) contrast(1.12) saturate(1.1);
      transform: scale(1.03);
    }

    .carousel-item-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 1.3vh 1.4vw;
      background: linear-gradient(180deg, transparent 0%, #0a0a0a 20%, #000 100%);
      color: white;
      z-index: 2;
      height: 28%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      transition: opacity 0.6s ease;
    }

    .carousel-item-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 1.4vw;
      width: 2.8vw;
      height: 3px;
      background: linear-gradient(90deg, #D59F0F 0%, transparent 100%);
      box-shadow: 0 0 12px rgba(213,159,15,0.8);
    }

    .item-title {
      font-size: 1.1vw;
      font-weight: 700;
      margin-bottom: 0.4vh;
      font-family: "Inter", sans-serif;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 0.1vw;
      text-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.9),
        0 0 20px rgba(0, 0, 0, 0.5);
      line-height: 1.2;
    }

    .item-description {
      font-size: 1.75vw;
      font-weight: 900;
      line-height: 1;
      color: #D59F0F;
      text-shadow: 
        0 0 20px rgba(213,159,15,0.6),
        0 0 40px rgba(213,159,15,0.3),
        2px 2px 0 #000;
      letter-spacing: 0.08vw;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8));
    }

    .footer-badge {
      position: fixed;
      bottom: 1.5vh;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 2.5vw;
      background: linear-gradient(135deg, #0a0a0a 0%, #000 100%);
      border: 2px solid rgba(213,159,15,0.6);
      padding: 1.5vh 4vw;
      border-radius: 16px;
      backdrop-filter: blur(10px);
      box-shadow: 
        0 8px 32px rgba(0,0,0,0.8),
        0 0 40px rgba(213,159,15,0.2),
        inset 0 1px 0 rgba(255,255,255,0.1);
      z-index: 2000;
      min-width: 40vw;
    }

    .footer-text {
      display: flex;
      flex-direction: column;
      gap: 0.2vh;
    }

    .footer-title {
      color: #D59F0F;
      font-weight: 700;
      font-size: 2vw;
      text-transform: uppercase;
      letter-spacing: 0.35vw;
      text-shadow: 0 0 20px rgba(213,159,15,0.4);
    }

    .footer-subtitle {
      color: #fff;
      font-weight: 500;
      font-size: 1.3vw;
      text-transform: uppercase;
      letter-spacing: 0.22vw;
      opacity: 0.9;
    }

    .qr-container {
      position: relative;
      width: 11vh;
      height: 11vh;
      background: white;
      border-radius: 8px;
      padding: 0;
      box-shadow: 
        0 0 20px rgba(213,159,15,0.4),
        inset 0 0 0 2px rgba(213,159,15,0.3);
      flex-shrink: 0;
      overflow: hidden;
    }

    .qr-code {
      width: 100%;
      height: 100%;
      background: white;
      position: relative;
      overflow: hidden;
    }

    .qr-code svg {
      width: 100%;
      height: 100%;
    }

    .loading-message {
      text-align: center;
      color: #D59F0F;
      font-size: 2vw;
      padding: 15vh 5vw;
      font-weight: 600;
      background: rgba(0,0,0,0.8);
      border: 1px solid rgba(213,159,15,0.5);
      border-radius: 16px;
      margin: auto;
      letter-spacing: 0.3vw;
      backdrop-filter: blur(10px);
      position: absolute;
      width: 100%;
      top: 50%;
      transform: translateY(-50%);
    }

    .error-message {
      text-align: center;
      color: #ff9f9f;
      font-size: 1.6vw;
      padding: 12vh 3vw;
      font-weight: 600;
      background: rgba(0,0,0,0.8);
      border: 1px solid rgba(255,159,159,0.5);
      border-radius: 16px;
      margin: auto;
      letter-spacing: 0.2vw;
      backdrop-filter: blur(10px);
      position: absolute;
      width: 100%;
      top: 50%;
      transform: translateY(-50%);
    }

    .carousel-item.entering {
      animation: fadeInScale 0.6s ease-out forwards;
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }
  </style>
</head>
<body>

  <div class="canvas-container">
    <canvas id="canvas"></canvas>
    <div class="header">
      <div class="venture-vault">VENTURE VAULT</div>
      <div class="subtitle">BISHOP FOLEY CATHOLIC</div>
    </div>
  </div>

  <div class="carousel-wrapper">
    <div class="carousel-container">
      <div class="carousel-track" id="carouselTrack">
        <div class="loading-message">Loading products...</div>
      </div>
    </div>
  </div>

  <div class="footer-badge">
    <div class="footer-text">
      <div class="footer-title">SEE ALL OUR PRODUCTS</div>
      <div class="footer-subtitle">Scan to Shop</div>
    </div>
    <div class="qr-container">
      <div class="qr-code">
        <img src="https://lh3.google.com/u/0/d/1MUqywewrUfHjP6YOcv_1gFlUD6kfhXze=k" alt="QR Code" style="width: 100%; height: 100%; object-fit: contain;">
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.15/paper-full.min.js"></script>
  <script>
    const SHEET_ID = '1DHK3Nh3dTtGXXQn6JUs7_01LAz1CdCu91FGUBxJMqAk';
    const GID = '0';
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&gid=${GID}`;
    
    let lastDataHash = '';
    
    function hashData(data) {
      let hash = 0;
      for (let i = 0; i < data.length; i++) {
        const char = data.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
      }
      return hash.toString();
    }
    
    class CurvedCarousel {
      constructor(displayTime = 3000, transitionTime = 1500) {
        this.items = [];
        this.totalItems = 0;
        this.currentIndex = 0;
        this.cycleTime = displayTime + transitionTime; 
        this.timer = null;
        this.wrapper = document.querySelector('.carousel-wrapper');
        this.track = document.getElementById('carouselTrack');
        this.isTransitioning = false;
      }
      
      init() {
        this.items = document.querySelectorAll('.carousel-item');
        this.totalItems = this.items.length;
        if (this.totalItems > 0) {
          this.updateCarousel();
          this.start();
          this.wrapper.addEventListener('mouseenter', () => clearInterval(this.timer));
          this.wrapper.addEventListener('mouseleave', () => this.start());
        }
      }
      
      start() {
        if (this.totalItems === 0) return;
        this.timer = setInterval(() => {
          this.currentIndex = (this.currentIndex + 1) % this.totalItems;
          this.updateCarousel();
        }, this.cycleTime);
      }
      
      updateCarousel() {
        this.items.forEach((item, index) => {
          item.classList.remove('active', 'left', 'right', 'far-left', 'far-right', 'edge-left', 'edge-right', 'hidden', 'right-hidden');
          
          let rel = (index - this.currentIndex + this.totalItems) % this.totalItems;
          if (rel > this.totalItems / 2) rel -= this.totalItems;
          
          if (rel === 0) {
            item.classList.add('active');
          } else if (rel === 1) {
            item.classList.add('right');
          } else if (rel === 2) {
            item.classList.add('far-right');
          } else if (rel === 3) {
            item.classList.add('edge-right');
          } else if (rel === -1) {
            item.classList.add('left');
          } else if (rel === -2) {
            item.classList.add('far-left');
          } else if (rel === -3) {
            item.classList.add('edge-left');
          } else if (rel > 3) {
            item.classList.add('hidden', 'right-hidden');
          } else {
            item.classList.add('hidden');
          }
        });
      }
      
      restart() {
        if (this.timer) {
          clearInterval(this.timer);
        }
        this.init();
      }
    }
    
    let carousel = new CurvedCarousel(3500, 1200);
    
    async function loadProducts() {
      const track = document.getElementById('carouselTrack');
      
      try {
        const response = await fetch(SHEET_URL);
        const csvText = await response.text();
        
        const currentHash = hashData(csvText);
        
        if (currentHash === lastDataHash && track.querySelectorAll('.carousel-item').length > 0) {
          return;
        }
        
        lastDataHash = currentHash;
        
        const lines = csvText.trim().split('\n');
        const headers = lines[0].split(',').map(h => h.trim().toLowerCase().replace(/"/g, ''));
        
        const newProducts = [];
        
        for (let i = 1; i < lines.length; i++) {
          const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
          
          const nameIndex = headers.indexOf('name') >= 0 ? headers.indexOf('name') : 0;
          const priceIndex = headers.indexOf('price') >= 0 ? headers.indexOf('price') : 1;
          const imageIndex = headers.indexOf('image') >= 0 ? headers.indexOf('image') : 2;
          
          const name = values[nameIndex] || 'Product';
          const price = values[priceIndex] || '$0';
          const image = values[imageIndex] || 'https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=800&q=80';
          
          newProducts.push({ name, price, image });
        }
        
        track.innerHTML = '';
        
        const displayProducts = [];
        if (newProducts.length === 0) {
          throw new Error('No products found');
        }
        
        while (displayProducts.length < 7) {
          for (let i = 0; i < newProducts.length && displayProducts.length < 7; i++) {
            displayProducts.push(newProducts[i]);
          }
        }
        
        displayProducts.slice(0, 7).forEach((product, index) => {
          const card = document.createElement('div');
          card.className = 'carousel-item';
          card.setAttribute('data-index', index);
          card.innerHTML = `
            <div class="product-image-container">
              <img src="${product.image}" alt="${product.name}" loading="lazy">
            </div>
            <div class="carousel-item-content">
              <div class="item-title">${product.name}</div>
              <div class="item-description">${product.price}</div>
            </div>
          `;
          track.appendChild(card);
        });
        
        carousel.restart();
        
      } catch (error) {
        if (track.querySelectorAll('.carousel-item').length === 0) {
          track.innerHTML = '<div class="error-message">Error loading products. Please check your Google Sheets settings.</div>';
        }
        console.error('Error loading products:', error);
      }
    }
    
    loadProducts();
    setInterval(loadProducts, 5000);
    
    // Paper.js animation
    paper.install(window);
    paper.setup(document.getElementById("canvas"));
    
    var canvasWidth, canvasHeight, canvasMiddleX, canvasMiddleY;
    var shapeGroup = new Group();
    var positionArray = [];

    function getCanvasBounds() {
      canvasWidth = view.size.width;
      canvasHeight = view.size.height;
      canvasMiddleX = canvasWidth / 2;
      canvasMiddleY = canvasHeight / 2;
      
      var position1 = {x: (canvasMiddleX / 2) + 100, y: 100};
      var position2 = {x: 200, y: canvasMiddleY};
      var position3 = {x: (canvasMiddleX - 50) + (canvasMiddleX / 2), y: 150};
      var position4 = {x: 0, y: canvasMiddleY + 100};
      var position5 = {x: canvasWidth - 130, y: canvasHeight - 75};
      var position6 = {x: canvasMiddleX + 80, y: canvasHeight - 50};
      var position7 = {x: canvasWidth + 60, y: canvasMiddleY - 50};
      var position8 = {x: canvasMiddleX + 100, y: canvasMiddleY + 100};
      
      positionArray = [position3, position2, position5, position4, position1, position6, position7, position8];
    }
    
    function initializeShapes() {
      getCanvasBounds();
      var shapePathData = [
        'M231,352l445-156L600,0L452,54L331,3L0,48L231,352',
        'M0,0l64,219L29,343l535,30L478,37l-133,4L0,0z',
        'M0,65l16,138l96,107l270-2L470,0L337,4L0,65z',
        'M333,0L0,94l64,219L29,437l570-151l-196-42L333,0',
        'M331.9,3.6l-331,45l231,304l445-156l-76-196l-148,54L331.9,3.6z',
        'M389,352l92-113l195-43l0,0l0,0L445,48l-80,1L122.7,0L0,275.2L162,297L389,352',
        'M 50 100 L 300 150 L 550 50 L 750 300 L 500 250 L 300 450 L 50 100',
        'M 700 350 L 500 350 L 700 500 L 400 400 L 200 450 L 250 350 L 100 300 L 150 50 L 350 100 L 250 150 L 450 150 L 400 50 L 550 150 L 350 250 L 650 150 L 650 50 L 700 150 L 600 250 L 750 250 L 650 300 L 700 350'
      ];
      
      for (var i = 0; i < shapePathData.length; i++) {
        var headerShape = new Path({
          strokeColor: 'rgba(213, 159, 15, 0.9)',
          strokeWidth: 4,
          parent: shapeGroup,
        });
        headerShape.pathData = shapePathData[i];
        headerShape.scale(2);
        headerShape.position = positionArray[i];
      }
    }
    
    initializeShapes();
    
    view.onFrame = function paperOnFrame(event) {
      if (event.count % 4 === 0) {
        for (var i = 0; i < shapeGroup.children.length; i++) {
          if (i % 2 === 0) {
            shapeGroup.children[i].rotate(-0.08);
          } else {
            shapeGroup.children[i].rotate(0.08);
          }
        }
      }
    };
    
    view.onResize = function paperOnResize() {
      getCanvasBounds();
      for (var i = 0; i < shapeGroup.children.length; i++) {
        shapeGroup.children[i].position = positionArray[i];
      }
      if (canvasWidth < 700) {
        shapeGroup.children[3].opacity = 0;
        shapeGroup.children[2].opacity = 0;
        shapeGroup.children[5].opacity = 0;
      } else {
        shapeGroup.children[3].opacity = 1;
        shapeGroup.children[2].opacity = 1;
        shapeGroup.children[5].opacity = 1;
      }
    };
  </script>
</body>
</html>
